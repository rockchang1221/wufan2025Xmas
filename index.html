<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è–èª•å¹¸é‹åˆ®åˆ®æ¨‚</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script>
        // ============================================================
        // ã€è€å¸«è«‹æ³¨æ„ã€‘è«‹å°‡ GAS Web App URL è²¼åœ¨ä¸‹æ–¹
        // ============================================================
        const TEACHER_GAS_URL = ""; 
        // ============================================================
    </script>

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: radial-gradient(circle at center, #8b0000 0%, #3f0000 100%);
            overflow-x: hidden;
            touch-action: manipulation;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* æ‰‹æ©Ÿç‰ˆé›ªèŠ± (æ•¸é‡ç¨å¾®æ¸›å°‘é¿å…å¡é “) */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #fff;
            opacity: 0.8;
            font-size: 1.2em;
            user-select: none;
            z-index: 0;
            animation: fall 8s linear infinite;
            pointer-events: none;
        }
        @keyframes fall { to { transform: translateY(110vh); } }
        .snowflake:nth-child(2n) { animation-duration: 7s; left: 20%; }
        .snowflake:nth-child(3n) { animation-duration: 9s; left: 80%; }

        /* æ‰‹æ©Ÿç‰ˆå¡ç‰‡å®¹å™¨ */
        .mobile-card {
            width: 90%;
            max-width: 400px; /* é™åˆ¶æœ€å¤§å¯¬åº¦é©æ‡‰æ‰‹æ©Ÿ */
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            position: relative;
            z-index: 10;
        }

        /* åˆ®åˆ®å¡å€åŸŸ - å¼·åˆ¶æ­£æ–¹å½¢æˆ–é©åˆæ‰‹æ©Ÿçš„æ¯”ä¾‹ */
        .scratch-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1; /* æ‰‹æ©Ÿä¸Šæ–¹å½¢æ¯”è¼ƒå¥½åˆ® */
            margin: 0 auto;
            border-radius: 16px;
            overflow: hidden;
            border: 4px solid #d4af37;
            user-select: none;
        }
        .prize-layer {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, #fff 0%, #f0fdf4 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
            padding: 10px;
        }
        canvas {
            position: absolute;
            inset: 0;
            z-index: 2;
            touch-action: none;
            width: 100%;
            height: 100%;
        }

        .input-group label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 4px;
            display: block;
            font-weight: bold;
        }
        .input-group input {
            width: 100%;
            padding: 16px; /* åŠ å¤§è§¸æ§å€ */
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            font-size: 1.2rem;
            text-align: center;
            font-weight: bold;
            outline: none;
            transition: all 0.3s;
        }
        .input-group input:focus {
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
        }
    </style>
</head>
<body>
    <!-- é›ªèŠ±è£é£¾ -->
    <div class="snowflake" style="left:10%">â„</div>
    <div class="snowflake" style="left:30%">â…</div>
    <div class="snowflake" style="left:70%">â†</div>
    <div class="snowflake" style="left:90%">â„</div>

    <!-- æ‰‹æ©Ÿç‰ˆæ¨™é¡Œ -->
    <div class="text-center mb-6 z-10">
        <h1 class="text-3xl font-black text-white drop-shadow-md mb-1">ğŸ„ è–èª•åˆ®åˆ®æ¨‚</h1>
        <p class="text-red-200 text-sm font-bold tracking-widest uppercase">Student Edition</p>
    </div>

    <div class="mobile-card">
        <!-- é ‚éƒ¨è£é£¾æ¢ -->
        <div class="h-2 w-full bg-gradient-to-r from-green-500 via-red-500 to-green-500"></div>
        
        <div class="p-6">
            
            <!-- æ­¥é©Ÿ 1: è¼¸å…¥è³‡æ–™ -->
            <div id="step-input" class="space-y-5">
                <div class="input-group">
                    <label>æ‚¨çš„å§“å</label>
                    <input type="text" id="input-name" placeholder="è«‹è¼¸å…¥åå­—">
                </div>

                <div class="input-group">
                    <label>å…Œæ›åºè™Ÿ</label>
                    <input type="text" id="input-code" placeholder="CODE" class="uppercase">
                </div>

                <button onclick="game.verifyCode()" id="btn-verify"
                    class="w-full bg-gradient-to-b from-green-600 to-green-800 text-white py-4 rounded-xl font-bold text-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2 mt-4">
                    <i data-lucide="gift"></i> é–‹å§‹åˆ®ç
                </button>

                <div id="msg-box" class="hidden p-3 rounded-lg text-center bg-red-100 text-red-600 font-bold text-sm animate-pulse border border-red-200">
                    <span>éŒ¯èª¤è¨Šæ¯</span>
                </div>
            </div>

            <!-- æ­¥é©Ÿ 2: åˆ®åˆ®æ¨‚ -->
            <div id="step-scratch" class="hidden space-y-4 text-center">
                <div class="bg-green-100 text-green-800 px-4 py-2 rounded-full font-bold text-sm inline-flex items-center gap-1">
                    <i data-lucide="check-circle" class="w-4 h-4"></i> é©—è­‰æˆåŠŸ
                </div>
                
                <div class="scratch-container">
                    <div class="prize-layer">
                        <i data-lucide="party-popper" class="w-10 h-10 text-red-500 mb-1"></i>
                        <h3 class="text-red-500 font-bold text-sm">æ­å–œç²å¾—</h3>
                        <p id="prize-text" class="text-2xl font-black text-gray-800 leading-tight px-2">...</p>
                    </div>
                    <canvas id="scratch-canvas"></canvas>
                </div>

                <p class="text-gray-400 text-xs mt-2">è«‹çœ‹å‰æ–¹å¤§è¢å¹•ç¢ºèªä¸­çåå–®ï¼</p>
            </div>

        </div>
    </div>

    <script>
        lucide.createIcons();

        const game = {
            verifyCode: async () => {
                const name = document.getElementById('input-name').value.trim();
                const code = document.getElementById('input-code').value.trim();
                const btn = document.getElementById('btn-verify');
                
                if (!name || !code) return game.showError("è«‹å®Œæ•´è¼¸å…¥å§“åèˆ‡åºè™Ÿ");

                btn.disabled = true;
                btn.innerHTML = '<i class="animate-spin w-5 h-5"></i> è™•ç†ä¸­...';
                game.hideError();

                if (TEACHER_GAS_URL) {
                    try {
                        const res = await fetch(TEACHER_GAS_URL, {
                            method: 'POST',
                            body: JSON.stringify({ action: 'verify', code: code, name: name })
                        });
                        const data = await res.json();
                        if (data.status === 'success') {
                            game.showPrize(data.prize.name);
                        } else {
                            game.showError(data.message);
                        }
                    } catch (e) {
                        game.showError("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
                    }
                } else {
                    // æ¸¬è©¦æ¨¡å¼ (å¦‚æœå¿˜è¨˜å¡« URL)
                    setTimeout(() => {
                        if(code === 'VIP') game.showPrize("æ¸¬è©¦çå“ï¼šä¹–ä¹–");
                        else game.showError("æ¸¬è©¦æ¨¡å¼ï¼šè«‹å¡«å…¥ GAS URL");
                    }, 800);
                }
                
                if(!document.getElementById('step-scratch').classList.contains('hidden')){
                    // æˆåŠŸå¾Œä¸ç”¨æ¢å¾©æŒ‰éˆ•
                } else {
                    btn.disabled = false;
                    btn.innerHTML = '<i data-lucide="gift"></i> é–‹å§‹åˆ®ç';
                    lucide.createIcons();
                }
            },
            showError: (msg) => {
                const box = document.getElementById('msg-box');
                box.classList.remove('hidden');
                box.querySelector('span').innerText = msg;
            },
            hideError: () => document.getElementById('msg-box').classList.add('hidden'),
            showPrize: (name) => {
                document.getElementById('step-input').classList.add('hidden');
                document.getElementById('step-scratch').classList.remove('hidden');
                document.getElementById('prize-text').innerText = name;
                scratchPad.init();
            }
        };

        const scratchPad = {
            init: () => {
                const c = document.getElementById('scratch-canvas');
                const ctx = c.getContext('2d');
                // è¨­å®šé«˜è§£æåº¦
                const size = 500; 
                c.width = size; c.height = size; 
                
                // éŠ€æ¼†å±¤
                const g = ctx.createLinearGradient(0,0,size,size);
                g.addColorStop(0,'#ddd'); g.addColorStop(1,'#999');
                ctx.fillStyle = g; ctx.fillRect(0,0,size,size);
                
                // æ–‡å­—
                ctx.fillStyle = '#555'; ctx.font = 'bold 60px sans-serif';
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText("åˆ®é–‹", size/2, size/2);

                ctx.globalCompositeOperation = 'destination-out';
                let drawing = false;

                const getPos = (e) => {
                    const r = c.getBoundingClientRect();
                    const t = e.touches?e.touches[0]:e;
                    return { x: (t.clientX-r.left)*(size/r.width), y: (t.clientY-r.top)*(size/r.height) };
                };
                const draw = (e) => {
                    if(!drawing) return; e.preventDefault();
                    const p = getPos(e); ctx.beginPath(); ctx.arc(p.x, p.y, 40, 0, Math.PI*2); ctx.fill();
                };
                c.onmousedown=c.ontouchstart=(e)=>{drawing=true;draw(e);};
                c.onmousemove=c.ontouchmove=draw;
                c.onmouseup=c.ontouchend=()=>{drawing=false;};
            }
        };
    </script>
</body>
</html>
